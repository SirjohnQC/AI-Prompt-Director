<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Prompt Director</title>
    
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ü§ñ</text></svg>">

    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/atom-one-dark-reasonable.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js"></script>
    
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    
    <link rel="stylesheet" href="/static/style.css?v=2">
    <script type="module" src="/static/app.js?v=2"></script>
</head>
	
<body class="bg-[#0f111a] text-white h-screen flex overflow-hidden">

    <div class="w-[400px] bg-[#161b22] border-r border-white/5 flex flex-col z-20 shadow-2xl flex-shrink-0">
        <div class="p-5 border-b border-white/5 bg-[#161b22] z-10 flex justify-between items-center">
            <div>
                <h1 class="font-bold text-lg tracking-wide flex items-center gap-2">
                    <div class="w-3 h-3 rounded-full bg-cyan-400 shadow-[0_0_10px_rgba(34,211,238,0.5)] animate-pulse"></div>
                    PROMPT<span class="font-light text-slate-400">DIRECTOR</span>
                </h1>
                <p class="text-[9px] text-slate-500 mt-0.5 uppercase tracking-wider"><span id="app-version">v--</span> ‚Ä¢ Intelligent Analysis</p>
            </div>
        </div>

        <div class="flex-1 overflow-y-auto custom-scrollbar p-5 flex flex-col gap-5">
            <div class="bg-[#0d1117] rounded-xl border border-white/5 p-3">
                <label class="text-[9px] font-bold text-purple-400 uppercase tracking-widest mb-2 flex items-center gap-2">
                    <i class="fas fa-user-circle"></i> Active Persona
                </label>
                <div class="flex gap-2">
                    <select id="persona-select" class="flex-1 bg-[#161b22] border border-white/10 rounded-lg px-3 py-2 text-xs text-purple-100 focus:border-purple-500 focus:outline-none transition-colors cursor-pointer hover:border-purple-500/50">
                        <option value="none">No Persona (Auto-detect)</option>
                    </select>
                    <button id="manage-personas-btn" class="bg-[#161b22] hover:bg-slate-800 text-slate-400 hover:text-white px-3 rounded-lg border border-white/10 transition-all" title="Manage"><i class="fas fa-list"></i></button>
                    <button id="add-persona-btn" class="bg-purple-600/20 hover:bg-purple-600 text-purple-400 hover:text-white px-3 rounded-lg border border-purple-500/30 transition-all font-bold" title="Scan New"><i class="fas fa-plus"></i></button>
                </div>
            </div>
            
            <div class="bg-[#0d1117] rounded-xl border border-white/5 p-3 mt-2">
                <label class="text-[9px] font-bold text-pink-400 uppercase tracking-widest mb-2 flex items-center gap-2">
                    <i class="fas fa-tshirt"></i> Active Wardrobe
                </label>
                <input type="hidden" id="wardrobe-id-hidden" value="none">
                <div id="wardrobe-trigger" class="group bg-[#161b22] border border-white/10 hover:border-pink-500/50 rounded-lg p-2 flex items-center gap-3 cursor-pointer transition-all shadow-sm">
                    <div id="active-wardrobe-img" class="w-10 h-10 rounded-md bg-slate-800 bg-cover bg-center flex-shrink-0 border border-white/5 relative overflow-hidden">
                        <div class="absolute inset-0 flex items-center justify-center text-slate-600 text-xs bg-[#0d1117]"><i class="fas fa-ban"></i></div>
                    </div>
                    <div class="flex-1 min-w-0">
                        <p class="text-[9px] text-slate-500 font-bold uppercase">Selected Outfit</p>
                        <p id="active-wardrobe-name" class="text-xs text-white font-medium truncate group-hover:text-pink-400 transition-colors">None (Default)</p>
                    </div>
                    <div class="px-2 text-slate-600 group-hover:text-white transition-colors"><i class="fas fa-chevron-right"></i></div>
                </div>
            </div>

            <div class="space-y-2">
                <div class="flex bg-[#0d1117] rounded-lg p-1 border border-white/5">
                    <button id="mode-image" class="flex-1 py-1.5 text-[10px] font-bold rounded bg-cyan-600 text-white shadow-sm transition-all"><i class="fas fa-image mr-1"></i> IMAGE</button>
                    <button id="mode-text" class="flex-1 py-1.5 text-[10px] font-bold rounded text-slate-400 hover:text-white transition-all"><i class="fas fa-align-left mr-1"></i> TEXT</button>
                </div>

                <div id="input-container-image">
                    <div id="drop-zone" class="relative h-72 border-2 border-dashed border-white/10 rounded-xl hover:border-cyan-500/50 hover:bg-cyan-500/5 transition-all cursor-pointer flex items-center justify-center overflow-hidden group bg-[#0d1117] shadow-inner">
                        <input type="file" id="file-input" class="hidden" accept="image/*">
                        <div id="empty-state" class="text-center z-10 pointer-events-none group-hover:-translate-y-1 transition-transform duration-300">
                            <div class="w-16 h-16 rounded-full bg-white/5 flex items-center justify-center mx-auto mb-3 group-hover:scale-110 transition-transform">
                                <i class="fas fa-cloud-upload-alt text-3xl text-slate-500 group-hover:text-cyan-400 transition-colors"></i>
                            </div>
                            <p class="text-[9px] text-slate-500 group-hover:text-cyan-300 uppercase tracking-widest font-bold">Click or Drop Image</p>
                        </div>
                        <div id="preview-container" class="hidden absolute inset-0 w-full h-full bg-[#0d1117]">
                            <img id="thumb-blur" class="absolute inset-0 w-full h-full object-cover opacity-20 blur-xl">
                            <img id="thumb-main" class="absolute inset-0 w-full h-full object-contain p-2 z-10">
                            <button id="clear-image" class="absolute top-2 right-2 bg-black/60 hover:bg-red-600 text-white rounded-lg w-8 h-8 flex items-center justify-center text-xs z-20 border border-white/10 transition-all shadow-lg hover:shadow-red-500/20"><i class="fas fa-trash-alt"></i></button>
                        </div>
                    </div>
                    <div class="flex gap-2 mt-2">
                        <div class="flex-1 relative">
                            <i class="fas fa-link absolute left-3 top-2.5 text-slate-600 text-xs"></i>
                            <input type="text" id="url-input" class="w-full bg-[#0d1117] border border-white/10 rounded-lg pl-8 pr-3 py-2 text-[10px] text-slate-300 focus:border-cyan-500 outline-none transition-colors" placeholder="Or paste Image URL...">
                        </div>
                        <button id="url-load-btn" class="bg-[#0d1117] border border-white/10 hover:border-cyan-500 hover:text-cyan-400 text-slate-500 px-3 rounded-lg transition-all"><i class="fas fa-arrow-right"></i></button>
                    </div>
                </div>

                <div id="input-container-text" class="hidden">
                    <textarea id="text-prompt-input" class="w-full h-72 bg-[#0d1117] border border-white/10 rounded-xl p-4 text-xs text-slate-300 focus:border-cyan-500 focus:outline-none resize-none custom-scrollbar leading-relaxed font-mono" placeholder="// Paste your raw prompt here..."></textarea>
                </div>
            </div>

            <div class="bg-[#0d1117] rounded-xl border border-white/5 p-3">
                <label class="text-[9px] font-bold text-green-400 uppercase tracking-widest mb-2 flex items-center gap-2">
                    <i class="fas fa-paragraph"></i> Narrative Style
                </label>
                <div class="flex gap-2">
                    <select id="style-select" class="flex-1 bg-[#161b22] border border-white/10 rounded-lg px-3 py-2 text-xs text-green-100 focus:border-green-500 focus:outline-none transition-colors cursor-pointer">
                        <option value="default">Standard</option>
                    </select>
                    <button id="delete-style-btn" class="bg-[#161b22] hover:bg-red-600 text-slate-500 hover:text-white px-3 rounded-lg border border-white/10 transition-all" title="Delete Style"><i class="fas fa-trash"></i></button>
                    <button id="open-style-btn" class="bg-[#161b22] hover:bg-slate-800 text-green-400 hover:text-white px-3 rounded-lg border border-white/10 transition-all" title="Learn New Style"><i class="fas fa-plus"></i></button>
                </div>
            </div>

            <div class="space-y-3">
                <details class="group bg-[#0d1117] rounded-xl border border-white/5 overflow-hidden open:border-slate-600/30 transition-colors">
                    <summary class="flex justify-between items-center p-3 cursor-pointer select-none bg-[#161b22] hover:bg-[#1c2128]">
                        <span class="text-[10px] font-bold text-slate-400 uppercase tracking-widest flex items-center gap-2 group-open:text-cyan-400"><i class="fas fa-sliders-h"></i> Scene Control</span>
                        <i class="fas fa-chevron-down text-[10px] text-slate-600 group-open:rotate-180 transition-transform"></i>
                    </summary>
                    <div class="p-3 grid grid-cols-2 gap-2 animate-in slide-in-from-top-2 duration-200">
                        <select id="time-select" class="bg-[#161b22] border border-white/10 rounded px-2 py-1.5 text-[10px] text-slate-300 focus:border-cyan-500 outline-none"><option value="auto">Auto Time</option><option value="Golden Hour">Golden Hour</option><option value="Noon">High Noon</option><option value="Blue Hour">Blue Hour</option><option value="Night">Night</option></select>
                        <select id="ratio-select" class="bg-[#161b22] border border-white/10 rounded px-2 py-1.5 text-[10px] text-slate-300 focus:border-cyan-500 outline-none"><option value="auto">Auto Ratio</option><option value="9:16">9:16 Story</option><option value="3:4">3:4 Portrait</option><option value="1:1">1:1 Square</option><option value="16:9">16:9 Cinema</option></select>
                        <select id="style-manual-select" class="bg-[#161b22] border border-white/10 rounded px-2 py-1.5 text-[10px] text-slate-300 focus:border-cyan-500 outline-none"><option value="auto">Auto Vibe</option><option value="Instagram">Instagram</option><option value="Cinematic">Cinematic</option><option value="Analog">Analog</option><option value="Fantasy">Fantasy</option><option value="Anime">Anime</option></select>
                        <select id="quality-select" class="bg-[#161b22] border border-white/10 rounded px-2 py-1.5 text-[10px] text-slate-300 focus:border-cyan-500 outline-none"><option value="auto">Auto Quality</option><option value="Best">Best (8k)</option><option value="Raw">Raw Photo</option><option value="Phone">Phone</option><option value="Vintage">Vintage</option></select>
                    </div>
                </details>

                <details class="group bg-[#0d1117] rounded-xl border border-white/5 overflow-hidden open:border-slate-600/30 transition-colors">
                    <summary class="flex justify-between items-center p-3 cursor-pointer select-none bg-[#161b22] hover:bg-[#1c2128]">
                        <span class="text-[10px] font-bold text-slate-400 uppercase tracking-widest flex items-center gap-2 group-open:text-purple-400"><i class="fas fa-palette"></i> Style Overrides</span>
                        <i class="fas fa-chevron-down text-[10px] text-slate-600 group-open:rotate-180 transition-transform"></i>
                    </summary>
                    <div class="p-3 space-y-2 animate-in slide-in-from-top-2 duration-200">
                        <div class="grid grid-cols-2 gap-2">
                            <select id="hair-style-select" class="bg-[#161b22] border border-white/10 rounded px-2 py-1.5 text-[10px] text-slate-300 focus:border-purple-500 outline-none"><option value="auto">Auto Hair</option><option value="Bob Cut">Bob Cut</option><option value="Long Straight">Long Straight</option><option value="Messy Bun">Messy Bun</option><option value="Pixie Cut">Pixie Cut</option><option value="Ponytail">Ponytail</option><option value="Waves">Beach Waves</option><option value="Braids">Braids</option><option value="Curly">Curly</option></select>
                            <select id="hair-color-select" class="bg-[#161b22] border border-white/10 rounded px-2 py-1.5 text-[10px] text-slate-300 focus:border-purple-500 outline-none"><option value="auto">Auto Color</option><option value="Black">Black</option><option value="Brown">Brown</option><option value="Blonde">Blonde</option><option value="Red">Red</option><option value="Auburn">Auburn</option><option value="Platinum">Platinum</option><option value="White">White</option><option value="Pink">Pink</option><option value="Blue">Blue</option></select>
                        </div>
                        <div class="grid grid-cols-2 gap-2">
                            <select id="makeup-select" class="bg-[#161b22] border border-white/10 rounded px-2 py-1.5 text-[10px] text-slate-300 focus:border-purple-500 outline-none"><option value="auto">Auto Makeup</option><option value="No Makeup">Natural</option><option value="Korean Style">Korean</option><option value="Heavy Glam">Glam</option><option value="Goth">Goth</option><option value="Soft Glam">Soft Glam</option></select>
                            <select id="glasses-select" class="bg-[#161b22] border border-white/10 rounded px-2 py-1.5 text-[10px] text-slate-300 focus:border-purple-500 outline-none"><option value="auto">Auto Glasses</option><option value="none">No Glasses</option><option value="Reading Glasses">Reading</option><option value="Sunglasses">Sunglasses</option><option value="Round Glasses">Round</option><option value="Cat-Eye Glasses">Cat-Eye</option></select>
                        </div>
                        <select id="expr-select" class="w-full bg-[#161b22] border border-white/10 rounded px-2 py-1.5 text-[10px] text-slate-300 focus:border-purple-500 outline-none"><option value="auto">Auto Expression</option><option value="Seductive">üòè Seductive</option><option value="Happy">üòä Happy</option><option value="Smirking">üòé Smirking</option><option value="Serious">üòê Serious</option><option value="Bored">üòë Bored</option><option value="Angry">üò† Angry</option></select>
                        <label class="flex items-center gap-2 p-2 rounded cursor-pointer hover:bg-white/5">
                            <input type="checkbox" id="reference-mode" class="w-3.5 h-3.5 rounded border-white/20 bg-[#0d1117] text-purple-500 focus:ring-0">
                            <span class="text-[10px] text-slate-400 font-medium">Keep original person (Ref Mode)</span>
                        </label>
                    </div>
                </details>
            </div>
        </div>

        <div class="p-5 border-t border-white/5 bg-[#161b22] space-y-3">
            <button id="action-btn" class="w-full py-3.5 font-bold text-xs uppercase tracking-widest rounded-xl shadow-lg transition-all active:scale-95 flex items-center justify-center gap-2 bg-gradient-to-r from-cyan-600 to-cyan-500 hover:from-cyan-500 hover:to-cyan-400 text-white">
                <i class="fas fa-magic"></i> <span id="action-btn-text">ANALYZE IMAGE</span>
            </button>
            <div class="flex justify-between items-center pt-2">
                <span class="text-[10px] font-bold text-slate-600 uppercase tracking-widest">History</span>
                <div class="flex gap-2">
                    <button id="clear-history-btn" class="text-[10px] text-slate-500 hover:text-red-400 transition-colors">Clear</button>
                    <button id="flush-btn" class="text-[10px] text-orange-500 hover:text-orange-400 font-bold">Free RAM</button>
                    <button id="quit-btn" class="text-[10px] text-red-500 hover:text-red-400 font-bold ml-2">Quit</button>
                </div>
            </div>
            <div id="history-list" class="overflow-y-auto h-32 custom-scrollbar bg-[#0d1117] rounded-lg border border-white/5 p-2 space-y-1"></div>
        </div>
    </div>

    <div class="flex-1 flex flex-col bg-[#0d1117] relative">
        <div class="h-14 border-b border-white/5 flex items-center justify-between px-6 bg-[#161b22]/50 backdrop-blur z-30">
            <div class="flex items-center gap-3">
                <i class="fas fa-code text-cyan-400"></i><span class="text-xs font-mono text-slate-400" id="current-filename">ready.json</span>
            </div>
            
            <div id="system-monitor" class="flex items-center gap-3 bg-[#0d1117]/80 border border-white/5 rounded-lg px-3 py-1.5 text-[10px] font-mono">
                <div class="flex items-center gap-1.5" title="CPU Usage"><i class="fas fa-microchip text-blue-400"></i><span id="mon-cpu" class="text-slate-400">--%</span></div>
                <div class="w-px h-4 bg-white/10"></div>
                <div class="flex items-center gap-1.5" title="GPU Usage"><i class="fas fa-tv text-green-400"></i><span id="mon-gpu" class="text-slate-400">--%</span></div>
                <div class="w-px h-4 bg-white/10"></div>
                <div class="flex items-center gap-1.5" title="VRAM"><i class="fas fa-memory text-purple-400"></i><span id="mon-vram" class="text-slate-400">--/--</span></div>
                <div class="w-px h-4 bg-white/10"></div>
                <div class="flex items-center gap-1.5" title="RAM"><i class="fas fa-database text-orange-400"></i><span id="mon-ram" class="text-slate-400">--%</span></div>
                <div class="w-px h-4 bg-white/10"></div>
                <div class="flex items-center gap-1.5" title="GPU Temperature"><i class="fas fa-thermometer-half text-red-400"></i><span id="mon-temp" class="text-slate-400">--¬∞C</span></div>
            </div>
            
            <div class="flex items-center gap-2">
                <button id="settings-btn" class="text-slate-400 hover:text-white px-2" title="API Keys"><i class="fas fa-cog"></i></button>
                <select id="cloud-model" class="bg-[#0d1117] border border-purple-500/30 text-purple-200 text-[10px] rounded px-2 py-1.5 focus:outline-none">
                    <option value="grok">üåå Grok 2 (xAI)</option>
                    <option value="nanobana">üçå Nano Banana (Google)</option>
                    <option value="flux">‚ö° Flux.1 [Dev]</option>
                    <option value="illustrious">üé® Illustrious XL</option>
                </select>
                <button id="generate-cloud-btn" class="bg-gradient-to-r from-purple-600 to-blue-600 hover:from-purple-500 hover:to-blue-500 text-white text-xs font-bold px-4 py-1.5 rounded shadow-lg transition-all flex items-center gap-2"><i class="fas fa-cloud"></i> GENERATE</button>
            </div>

            <div class="flex bg-[#161b22] p-1 rounded-lg border border-white/10 gap-1 ml-4">
                <button id="tab-json" class="px-4 py-1.5 text-xs font-bold rounded transition-all flex items-center gap-2 text-cyan-400 bg-cyan-500/10 border border-cyan-500/50"><i class="fas fa-file-code"></i> JSON</button>
                <button id="tab-prompt" class="px-4 py-1.5 text-xs font-bold rounded transition-all flex items-center gap-2 text-slate-400 hover:text-green-400 hover:bg-green-500/10 border border-transparent"><i class="fas fa-paragraph"></i> PROMPT</button>
                <button id="tab-tags" class="px-4 py-1.5 text-xs font-bold rounded transition-all flex items-center gap-2 text-slate-400 hover:text-orange-400 hover:bg-orange-500/10 border border-transparent"><i class="fas fa-tags"></i> TAGS</button>
            </div>
            
            <div class="flex gap-2 ml-auto">
                <button id="batch-btn" class="text-xs text-cyan-400 hover:text-cyan-300 font-bold border border-cyan-400/20 px-3 py-1.5 rounded hover:bg-cyan-400/10 transition-colors flex items-center gap-2" title="Batch Image Analyzer"><i class="fas fa-layer-group"></i> BATCH</button>
                <button id="download-btn" class="text-xs text-slate-400 hover:text-slate-300 font-bold border border-slate-600/20 px-3 py-1.5 rounded hover:bg-slate-600/10 transition-colors"><i class="fas fa-download"></i></button>
                <button id="copy-btn" class="text-xs text-cyan-400 hover:text-cyan-300 font-bold border border-cyan-400/20 px-3 py-1.5 rounded hover:bg-cyan-400/10 transition-colors">COPY</button>
            </div>
        </div>

        <div class="flex-1 overflow-auto relative cursor-text custom-scrollbar pb-24" id="editor-wrapper">
            <div id="editor" class="language-json">// Select a tab and click the Generate button...</div>
            <div id="loader" class="hidden absolute inset-0 bg-[#0d1117]/95 backdrop-blur-sm flex flex-col items-center justify-center z-50">
                <div class="w-16 h-16 border-4 border-purple-500 border-t-transparent rounded-full animate-spin mb-4 loading-ring"></div>
                <div id="loader-text" class="text-purple-400 font-mono text-sm animate-pulse tracking-widest mb-2">PROCESSING</div>
                <div id="loader-sub" class="text-slate-500 text-xs">Please wait...</div>
            </div>
        </div>
        
        <div id="refiner-bar" class="absolute bottom-0 left-0 right-0 p-4 bg-gradient-to-t from-[#0d1117] via-[#0d1117] to-transparent z-40">
            <div class="max-w-3xl mx-auto flex gap-2 items-center bg-[#161b22] border border-white/10 p-2 rounded-xl shadow-2xl shadow-black/50">
                <div class="pl-3 text-cyan-500 animate-pulse"><i class="fas fa-sparkles"></i></div>
                <input id="refine-input" type="text" class="flex-1 bg-transparent border-none text-sm text-white focus:ring-0 focus:outline-none placeholder-slate-500" placeholder="Ask AI to change JSON... (e.g. 'Add red lipstick')">
                <button id="refine-btn" class="bg-cyan-600 hover:bg-cyan-500 text-white p-2 rounded-lg transition-all"><i class="fas fa-paper-plane"></i></button>
            </div>
        </div>
    </div>

    <div id="persona-modal" class="hidden fixed inset-0 z-50 flex items-center justify-center bg-black/80 backdrop-blur-sm">
        <div class="bg-[#161b22] w-full max-w-md rounded-2xl border border-white/10 p-6 max-h-[90vh] overflow-y-auto custom-scrollbar">
            <h3 id="modal-title-text" class="text-white font-bold mb-4 text-lg">Persona</h3>
            <div class="bg-[#0d1117] border border-white/5 rounded-lg p-3 mb-4">
                <label class="block text-[9px] text-purple-400 font-bold uppercase tracking-wider mb-2">Character Name</label>
                <input id="p-name" class="w-full bg-slate-900 border border-white/5 rounded px-3 py-2 text-sm text-white focus:border-purple-500 outline-none" placeholder="e.g. Sarah" required>
            </div>
            <div id="scan-preview-container" class="hidden relative h-56 rounded-lg overflow-hidden border border-white/10 mb-4 bg-black/50">
                <img id="scan-blur" class="absolute inset-0 w-full h-full object-cover opacity-30 blur-md">
                <img id="scan-main" class="absolute inset-0 w-full h-full object-contain p-2">
            </div>
            <div id="edit-photo-buttons" class="hidden grid grid-cols-2 gap-2 mb-4">
                <button id="trigger-rescan" class="bg-purple-600/20 hover:bg-purple-600 text-purple-300 hover:text-white px-4 py-3 rounded-lg font-bold text-xs border border-purple-500/30 transition-all"><i class="fas fa-sync-alt mr-2"></i>RE-SCAN</button>
                <button id="trigger-new-photo" class="bg-cyan-600/20 hover:bg-cyan-600 text-cyan-300 hover:text-white px-4 py-3 rounded-lg font-bold text-xs border border-cyan-500/30 transition-all"><i class="fas fa-camera mr-2"></i>NEW PHOTO</button>
            </div>
            <div id="scan-drop" class="border-2 border-dashed border-purple-500/30 rounded-lg h-32 flex items-center justify-center mb-4 cursor-pointer text-slate-400 hover:border-purple-500 hover:text-purple-400 transition-all bg-[#0d1117]">
                <div class="text-center"><i class="fas fa-cloud-upload-alt text-3xl mb-2"></i><p class="text-xs font-medium">Click to Upload Face</p></div>
            </div>
            <input type="file" id="scan-input" class="hidden" accept="image/*">
            <button id="scan-btn" class="w-full bg-purple-600 hover:bg-purple-500 text-white p-3 rounded-lg mb-4 font-bold text-sm transition-all"><i class="fas fa-magic mr-2"></i>SCAN & AUTO-FILL</button>
            <div id="scan-msg" class="hidden text-center text-xs text-cyan-400 font-bold mb-2">Scanning...</div>
            <div id="manual-fields" class="hidden space-y-4">
                <div class="bg-[#0d1117] border border-white/5 rounded-lg p-3">
                    <p class="text-[9px] text-cyan-400 font-bold mb-2 uppercase tracking-wider">Demographics</p>
                    <div class="grid grid-cols-2 gap-2">
                        <div><label class="block text-[9px] text-slate-500 mb-1">AGE</label><input id="p-age" class="w-full bg-slate-900 border border-white/5 rounded px-2 py-1.5 text-[11px] text-slate-300 focus:border-cyan-500 outline-none"></div>
                        <div><label class="block text-[9px] text-slate-500 mb-1">ETHNICITY</label><input id="p-ethnicity" class="w-full bg-slate-900 border border-white/5 rounded px-2 py-1.5 text-[11px] text-slate-300 focus:border-cyan-500 outline-none"></div>
                    </div>
                </div>
                <div class="bg-[#0d1117] border border-white/5 rounded-lg p-3">
                    <p class="text-[9px] text-purple-400 font-bold mb-2 uppercase tracking-wider">Body</p>
                    <div class="grid grid-cols-2 gap-2 mb-2">
                        <div><label class="block text-[9px] text-slate-500 mb-1">BUILD</label><input id="p-build" class="w-full bg-slate-900 border border-white/5 rounded px-2 py-1.5 text-[11px] text-slate-300 focus:border-purple-500 outline-none"></div>
                        <div><label class="block text-[9px] text-slate-500 mb-1">CHEST</label><input id="p-chest" class="w-full bg-slate-900 border border-white/5 rounded px-2 py-1.5 text-[11px] text-slate-300 focus:border-purple-500 outline-none"></div>
                    </div>
                    <div class="grid grid-cols-2 gap-2">
                        <div><label class="block text-[9px] text-slate-500 mb-1">SHOULDERS</label><input id="p-shoulders" class="w-full bg-slate-900 border border-white/5 rounded px-2 py-1.5 text-[11px] text-slate-300 focus:border-purple-500 outline-none"></div>
                        <div><label class="block text-[9px] text-slate-500 mb-1">WAIST</label><input id="p-waist" class="w-full bg-slate-900 border border-white/5 rounded px-2 py-1.5 text-[11px] text-slate-300 focus:border-purple-500 outline-none"></div>
                    </div>
                </div>
                <div class="bg-[#0d1117] border border-white/5 rounded-lg p-3">
                    <p class="text-[9px] text-green-400 font-bold mb-2 uppercase tracking-wider">Face</p>
                    <div class="grid grid-cols-2 gap-2 mb-2">
                        <div><label class="block text-[9px] text-slate-500 mb-1">SHAPE</label><input id="p-face" class="w-full bg-slate-900 border border-white/5 rounded px-2 py-1.5 text-[11px] text-slate-300 focus:border-green-500 outline-none"></div>
                        <div><label class="block text-[9px] text-slate-500 mb-1">SKIN</label><input id="p-skin" class="w-full bg-slate-900 border border-white/5 rounded px-2 py-1.5 text-[11px] text-slate-300 focus:border-green-500 outline-none"></div>
                    </div>
                    <div class="grid grid-cols-3 gap-2">
                        <div><label class="block text-[9px] text-slate-500 mb-1">EYES</label><input id="p-eyes" class="w-full bg-slate-900 border border-white/5 rounded px-2 py-1.5 text-[11px] text-slate-300 focus:border-green-500 outline-none"></div>
                        <div><label class="block text-[9px] text-slate-500 mb-1">NOSE</label><input id="p-nose" class="w-full bg-slate-900 border border-white/5 rounded px-2 py-1.5 text-[11px] text-slate-300 focus:border-green-500 outline-none"></div>
                        <div><label class="block text-[9px] text-slate-500 mb-1">LIPS</label><input id="p-lips" class="w-full bg-slate-900 border border-white/5 rounded px-2 py-1.5 text-[11px] text-slate-300 focus:border-green-500 outline-none"></div>
                    </div>
                </div>
                <div class="bg-[#0d1117] border border-white/5 rounded-lg p-3">
                    <p class="text-[9px] text-orange-400 font-bold mb-2 uppercase tracking-wider">Hair</p>
                    <div class="grid grid-cols-2 gap-2">
                        <div><label class="block text-[9px] text-slate-500 mb-1">COLOR</label><input id="p-hair-color" class="w-full bg-slate-900 border border-white/5 rounded px-2 py-1.5 text-[11px] text-slate-300 focus:border-orange-500 outline-none"></div>
                        <div><label class="block text-[9px] text-slate-500 mb-1">STYLE</label><input id="p-hair-style" class="w-full bg-slate-900 border border-white/5 rounded px-2 py-1.5 text-[11px] text-slate-300 focus:border-orange-500 outline-none"></div>
                    </div>
                </div>
                <div class="bg-[#0d1117] border border-white/5 rounded-lg p-3">
                    <p class="text-[9px] text-pink-400 font-bold mb-2 uppercase tracking-wider">Extras</p>
                    <div class="grid grid-cols-3 gap-2">
                        <div><label class="block text-[9px] text-slate-500 mb-1">MAKEUP</label><input id="p-makeup" class="w-full bg-slate-900 border border-white/5 rounded px-2 py-1.5 text-[11px] text-slate-300 focus:border-pink-500 outline-none"></div>
                        <div><label class="block text-[9px] text-slate-500 mb-1">EYEWEAR</label><input id="p-eyewear" class="w-full bg-slate-900 border border-white/5 rounded px-2 py-1.5 text-[11px] text-slate-300 focus:border-pink-500 outline-none"></div>
                        <div><label class="block text-[9px] text-slate-500 mb-1">TATTOOS</label><input id="p-tattoos" class="w-full bg-slate-900 border border-white/5 rounded px-2 py-1.5 text-[11px] text-slate-300 focus:border-pink-500 outline-none"></div>
                    </div>
                </div>
                <button id="update-manual-btn" class="w-full py-3 bg-green-600 hover:bg-green-500 text-white text-sm font-bold rounded-lg transition-all mt-2"><i class="fas fa-save mr-2"></i>SAVE CHANGES</button>
            </div>
            <div class="flex justify-end mt-4"><button id="close-modal" class="text-slate-400 hover:text-white text-sm">Close</button></div>
        </div>
        <input type="hidden" id="edit-pid">
    </div>    

    <div id="manager-modal" class="hidden fixed inset-0 z-50 flex items-center justify-center bg-black/80 backdrop-blur-sm">
        <div class="bg-[#161b22] w-full max-w-md rounded-2xl border border-white/10 p-6 h-[60vh] flex flex-col">
            <div class="flex justify-between mb-4"><h3 class="text-white font-bold">Manage</h3><button id="close-manager" class="text-slate-500">x</button></div>
            <div id="manager-list" class="overflow-y-auto flex-1 custom-scrollbar"></div>
        </div>
    </div>

    <div id="settings-modal" class="hidden fixed inset-0 z-[60] flex items-center justify-center bg-black/90 backdrop-blur-sm">
        <div class="bg-[#161b22] p-6 rounded-xl border border-white/10 w-96 max-h-[80vh] overflow-y-auto custom-scrollbar">
            <h3 class="font-bold text-white mb-3 flex items-center gap-2"><i class="fas fa-server text-cyan-400"></i> Local AI Models</h3>
            <div class="space-y-3 mb-6 bg-[#0d1117] p-3 rounded-lg border border-white/5">
                <div><label class="text-[9px] uppercase text-slate-500 font-bold block mb-1">Vision (Analysis)</label><select id="model-vision" class="w-full bg-[#161b22] border border-white/10 rounded p-2 text-xs text-slate-300 focus:border-cyan-500 outline-none"><option value="loading">Loading...</option></select></div>
                <div><label class="text-[9px] uppercase text-slate-500 font-bold block mb-1">Writer (Prompts)</label><select id="model-writer" class="w-full bg-[#161b22] border border-white/10 rounded p-2 text-xs text-slate-300 focus:border-green-500 outline-none"><option value="loading">Loading...</option></select></div>
                <div><label class="text-[9px] uppercase text-slate-500 font-bold block mb-1">Tagger (Vision)</label><select id="model-tagger" class="w-full bg-[#161b22] border border-white/10 rounded p-2 text-xs text-slate-300 focus:border-orange-500 outline-none"><option value="loading">Loading...</option></select></div>
            </div>
            <h3 class="font-bold text-white mb-3 flex items-center gap-2"><i class="fas fa-cloud text-purple-400"></i> Cloud API Keys</h3>
            <div class="space-y-4">
                <div><label class="text-[10px] uppercase text-slate-500 font-bold">xAI API Key (Grok)</label><input id="key-xai" type="password" class="w-full bg-[#0d1117] border border-white/10 rounded p-2 text-xs text-white"></div>
                <div><label class="text-[10px] uppercase text-slate-500 font-bold">Google API Key</label><input id="key-google" type="password" class="w-full bg-[#0d1117] border border-white/10 rounded p-2 text-xs text-white"></div>
                <div><label class="text-[10px] uppercase text-slate-500 font-bold">Fal.ai Key</label><input id="key-fal" type="password" class="w-full bg-[#0d1117] border border-white/10 rounded p-2 text-xs text-white"></div>
                <button id="save-keys-btn" class="w-full bg-cyan-600 hover:bg-cyan-500 text-white py-2 rounded font-bold text-xs mt-2">SAVE SETTINGS</button>
                <button id="close-settings" class="w-full text-slate-500 text-xs mt-2 hover:text-white">Close</button>
            </div>
        </div>
    </div>

    <div id="style-modal" class="hidden fixed inset-0 z-[70] flex items-center justify-center bg-black/80 backdrop-blur-sm">
        <div class="bg-[#161b22] w-full max-w-lg rounded-2xl border border-white/10 p-6 flex flex-col gap-4 shadow-2xl">
            <h3 class="text-white font-bold text-lg flex items-center gap-2"><i class="fas fa-brain text-cyan-400"></i> Adaptive Style Learner</h3>
            <div>
                <label class="text-[10px] uppercase text-slate-500 font-bold mb-1 block">1. Paste a "Golden Prompt" (e.g. from Civitai)</label>
                <textarea id="style-input-raw" class="w-full h-24 bg-[#0d1117] border border-white/10 rounded p-3 text-xs text-slate-300 focus:border-cyan-500 outline-none resize-none placeholder-slate-600" placeholder="Paste the text here..."></textarea>
            </div>
            <button id="analyze-style-btn" class="w-full bg-gradient-to-r from-cyan-600 to-blue-600 hover:from-cyan-500 hover:to-blue-500 text-white py-3 rounded-lg font-bold text-xs shadow-lg transition-all">ANALYZE STRUCTURE</button>
            <div id="style-analysis-result" class="hidden space-y-3 pt-3 border-t border-white/5">
                <div><label class="text-[10px] uppercase text-green-400 font-bold mb-1 block">2. AI Generated Rules</label><textarea id="style-instruction" class="w-full h-20 bg-[#0d1117] border border-green-500/30 rounded p-3 text-xs text-green-100 focus:border-green-500 outline-none resize-none"></textarea></div>
                <div class="flex gap-2"><input id="style-name" class="flex-1 bg-[#0d1117] border border-white/10 rounded p-2 text-xs text-white focus:border-green-500 outline-none" placeholder="Name (e.g. 'Realism V2')"><button id="save-style-btn" class="bg-green-600 hover:bg-green-500 text-white px-6 rounded font-bold text-xs">SAVE</button></div>
            </div>
            <div class="flex justify-end"><button id="close-style-modal" class="text-slate-500 hover:text-white text-xs font-bold">CANCEL</button></div>
        </div>
    </div>

    <div id="wardrobe-modal" class="hidden fixed inset-0 z-50 flex items-center justify-center bg-black/80 backdrop-blur-sm">
        <div class="bg-[#161b22] w-full max-w-md rounded-2xl border border-white/10 p-6">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-white font-bold text-lg"><i class="fas fa-tshirt text-pink-400 mr-2"></i>New Outfit</h3>
                <button id="close-wardrobe" class="text-slate-500 hover:text-white"><i class="fas fa-times"></i></button>
            </div>
            <div class="space-y-4">
                <div>
                    <label class="block text-[9px] text-slate-500 font-bold uppercase mb-1">Outfit Name</label>
                    <input id="w-name" class="w-full bg-[#0d1117] border border-white/10 rounded px-3 py-2 text-sm text-white focus:border-pink-500 outline-none" placeholder="e.g. Red Summer Dress">
                </div>
                <div class="grid grid-cols-2 gap-2">
                    <div id="w-upload-zone" class="border border-dashed border-white/20 rounded-lg h-24 flex flex-col items-center justify-center cursor-pointer hover:bg-white/5 transition-all text-slate-500 hover:text-pink-400">
                        <i class="fas fa-upload mb-1"></i><span class="text-[9px]">Upload Image</span>
                        <input type="file" id="w-file" class="hidden" accept="image/*">
                    </div>
                    <div class="flex flex-col gap-2">
                        <input id="w-url" class="bg-[#0d1117] border border-white/10 rounded px-2 py-1 text-[10px] text-white" placeholder="Or Paste URL...">
                        <div id="w-preview" class="flex-1 bg-black/50 rounded border border-white/5 bg-cover bg-center"></div>
                    </div>
                </div>
                <button id="save-wardrobe-btn" class="w-full bg-gradient-to-r from-pink-600 to-purple-600 hover:from-pink-500 hover:to-purple-500 text-white py-3 rounded-lg font-bold text-xs shadow-lg transition-all">ANALYZE & SAVE OUTFIT</button>
            </div>
        </div>
    </div>

    <div id="wardrobe-browser" class="hidden fixed inset-0 z-[80] items-center justify-center bg-black/90 backdrop-blur-md">
        <div class="bg-[#161b22] w-full max-w-5xl h-[85vh] rounded-2xl border border-white/10 flex flex-col shadow-2xl relative overflow-hidden">
            <div class="p-6 border-b border-white/10 flex justify-between items-center bg-[#161b22]/95 backdrop-blur z-10">
                <div>
                    <h2 class="text-2xl font-bold text-white tracking-tight flex items-center gap-3">
                        <span class="text-pink-500 bg-pink-500/10 p-2 rounded-lg"><i class="fas fa-tshirt"></i></span> My Wardrobe
                    </h2>
                    <p class="text-xs text-slate-400 mt-1">Select an outfit to inject into your prompt.</p>
                </div>
                <div class="flex items-center gap-3">
                    <div class="relative">
                        <i class="fas fa-search absolute left-3 top-2.5 text-slate-500 text-xs"></i>
                        <input id="wardrobe-search" type="text" placeholder="Search outfits..." class="bg-[#0d1117] border border-white/10 rounded-lg pl-9 pr-4 py-2 text-xs text-white focus:border-pink-500 outline-none w-48 transition-all focus:w-64">
                    </div>
                    <button id="browser-add-btn" class="bg-gradient-to-r from-pink-600 to-purple-600 hover:from-pink-500 hover:to-purple-500 text-white px-5 py-2 rounded-lg text-xs font-bold transition-all shadow-lg shadow-pink-900/20 flex items-center gap-2">
                        <i class="fas fa-plus"></i> NEW OUTFIT
                    </button>
                    <button id="close-browser" class="w-8 h-8 rounded-full bg-white/5 hover:bg-white/10 flex items-center justify-center text-slate-400 hover:text-white transition-all ml-2">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            </div>
            <div class="flex-1 overflow-y-auto custom-scrollbar p-6 bg-[#0d1117]">
                <div id="wardrobe-grid" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-4"></div>
                <div id="wardrobe-empty" class="hidden flex flex-col items-center justify-center h-64 text-slate-500">
                    <i class="fas fa-hanger text-4xl mb-4 opacity-50"></i>
                    <p class="text-sm">Your closet is empty.</p>
                    <button onclick="document.getElementById('browser-add-btn').click()" class="text-pink-400 text-xs font-bold mt-2 hover:underline">Add your first outfit</button>
                </div>
            </div>
            <div class="p-3 border-t border-white/10 bg-[#161b22] text-[10px] text-slate-500 flex justify-between px-6">
                <span><i class="fas fa-info-circle mr-1"></i> Click a card to wear it.</span>
                <span id="wardrobe-count">0 items</span>
            </div>
        </div>
    </div>

    <div id="img-result-modal" class="hidden fixed inset-0 z-[60] flex items-center justify-center bg-black/90 backdrop-blur-md">
        <div class="relative max-w-4xl w-full p-4 flex flex-col items-center">
            <button id="close-img-modal" class="absolute top-0 right-4 text-white hover:text-red-500 text-2xl">&times;</button>
            <div id="cloud-loader" class="hidden flex flex-col items-center justify-center h-96">
                <div class="w-20 h-20 border-4 border-blue-500 border-t-transparent rounded-full animate-spin mb-4"></div>
                <div class="text-blue-400 font-mono animate-pulse tracking-widest">RENDERING IN CLOUD...</div>
            </div>
            <img id="cloud-result-img" class="max-h-[85vh] rounded-lg shadow-2xl border border-white/10 hidden" />
            <div id="cloud-error" class="hidden text-red-400 font-mono mt-4 bg-red-900/20 p-4 rounded border border-red-500/50"></div>
        </div>
    </div>

    <div id="batch-modal-container"></div>
</body>
</html>